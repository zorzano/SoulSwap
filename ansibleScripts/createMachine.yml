
- hosts: localhost
  connection: local
  gather_facts: False

  tasks:

    - name: Provision a set of instances
      ec2:
        key_name: mortadelo
        #       group: test
        instance_type: t2.micro
        image: ami-785db401
        region: eu-west-1
        wait: true
        exact_count: 1
        group: mortadelo-WebServerSecurityGroup-1UEJBL11630E9
        count_tag:
          Name: soulswapserver 
        instance_tags:
          Name: soulswapserver
      register: ec2

    - debug:
        msg: "ec2.instances:{{ ec2.instances }}"

    - name: Wait for SSH to come up
      wait_for_connection:
        delay: 60
        timeout: 320
      with_items: "{{ ec2.instances }}"

      #    - name: Terminate instances that were previously launched
      #     ec2:
      #  state: 'absent'
      #  instance_ids: '{{ ec2.instance_ids }}'
      #  region: eu-west-1
